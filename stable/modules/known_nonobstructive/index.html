<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stable CP – Known Nonobstructive CAD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="app-shell">
    <header class="app-header">
      <div>
        <h1 class="app-title">
          Known CAD: Nonobstructive (&lt;50%)
          <span class="info-chip info-chip--inline" data-modal="modal-scope" title="Scope / definitions">i</span>
          <span class="info-chip info-chip--warn" data-modal="modal-redflags" title="Red flags / exclusions">!</span>
        </h1>
        <p class="app-subtitle">
          Stable chest pain pathway module. Clinician-selected branches with non-blocking guidance.
        </p>
      </div>
      <div class="app-meta">
        <a href="/stable/definitions.html"
   class="definitions-heart"
   title="Definitions"
   aria-label="Definitions">
  <svg viewBox="0 0 24 24" width="36" height="36" aria-hidden="true">
    <!-- Heart -->
    <path
      d="M12 21s-7.1-4.9-9.8-8.5C-.3 9.1 1.6 5 5.6 5c2.2 0 3.7 1.3 4.9 2.7C11.7 6.3 13.2 5 15.4 5c4 0 5.9 4.1 3.4 7.5C19.1 16.1 12 21 12 21z"
      fill="#d32f2f"/>
    <!-- Question mark -->
    <text
      x="12"
      y="15.2"
      text-anchor="middle"
      font-size="11"
      font-weight="800"
      fill="#ffffff"
      font-family="system-ui, -apple-system, BlinkMacSystemFont, sans-serif">
      ?
    </text>
  </svg>
</a>
        <a class="btn-secondary" href="/stable/known-cad.html">← Back</a>
      </div>
    </header>

    <main class="app-main">
      <!-- Inputs -->
      <section class="card card-inputs">
        <h2 class="card-title">Inputs</h2>

        <form id="tool-form" class="form-grid">

          <!-- OPTIONAL: Guided recommender (Wave 2 #1) -->
<details class="callout" style="margin-top:0.25rem;">
  <summary>
    <strong>Help me choose a test (optional)</strong>
    <span class="micro-note">Guided prompts; you can still choose manually.</span>
  </summary>

  <div style="margin-top:0.75rem;" class="form-grid">

    <!-- Step A -->
    <div class="form-field">
      <label class="field-label" for="rec_canExercise">
        Can the patient exercise adequately?
      </label>
      <select id="rec_canExercise" name="rec_canExercise" class="field-input">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="unknown">Unsure</option>
      </select>
    </div>

    <!-- Step B (only if exercise = yes) -->
    <div class="form-field" id="rec_ecgWrap" style="display:none;">
      <label class="field-label" for="rec_ecgInterpretable">
        Is baseline ECG interpretable for ischemia?
      </label>
      <select id="rec_ecgInterpretable" name="rec_ecgInterpretable" class="field-input">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="unknown">Unsure</option>
      </select>
    </div>

    <!-- Step C -->
    <div class="form-field" id="rec_hardStopsWrap" style="display:none;">
      <div class="callout">
        <strong>Key feasibility checks (optional)</strong>
        <ul>
          <li>Answer only what you know; “Unsure” is fine.</li>
          <li>These influence ranking, not eligibility.</li>
        </ul>
      </div>

      <label class="field-label" for="rec_bronchospasm">Severe bronchospasm/asthma limiting vasodilators?</label>
      <select id="rec_bronchospasm" name="rec_bronchospasm" class="field-input">
        <option value="">Select…</option>
        <option value="no">No</option>
        <option value="yes">Yes</option>
        <option value="unknown">Unsure</option>
      </select>

      <label class="field-label" for="rec_mriContra" style="margin-top:0.6rem;">MRI contraindication or severe claustrophobia?</label>
      <select id="rec_mriContra" name="rec_mriContra" class="field-input">
        <option value="">Select…</option>
        <option value="no">No</option>
        <option value="yes">Yes</option>
        <option value="unknown">Unsure</option>
      </select>

      <label class="field-label" for="rec_poorEcho" style="margin-top:0.6rem;">Poor echo windows expected?</label>
      <select id="rec_poorEcho" name="rec_poorEcho" class="field-input">
        <option value="">Select…</option>
        <option value="no">No</option>
        <option value="yes">Yes</option>
        <option value="unknown">Unsure</option>
      </select>
    </div>

    <!-- Step D -->
    <div class="form-field" id="rec_renalWrap" style="display:none;">
      <label class="field-label" for="rec_renalConcern">
        Renal impairment / contrast concern?
        <span class="micro-note">Affects contrast feasibility; does not override COR 1 ICA when indicated.</span>
      </label>
      <select id="rec_renalConcern" name="rec_renalConcern" class="field-input">
        <option value="">Select…</option>
        <option value="no">No</option>
        <option value="yes">Yes</option>
        <option value="unknown">Unsure</option>
      </select>
    </div>

    <!-- Step E (availability; only asked late) -->
    <div class="form-field" id="rec_availWrap" style="display:none;">
      <label class="field-label" for="rec_petAvail">PET available locally?</label>
      <select id="rec_petAvail" name="rec_petAvail" class="field-input">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="unknown">Unsure</option>
      </select>

      <label class="field-label" for="rec_cmrAvail" style="margin-top:0.6rem;">Stress CMR available locally?</label>
      <select id="rec_cmrAvail" name="rec_cmrAvail" class="field-input">
        <option value="">Select…</option>
        <option value="yes">Yes</option>
        <option value="no">No</option>
        <option value="unknown">Unsure</option>
      </select>
    </div>

    <!-- Output -->
    <div class="form-field">
      <div id="rec_output" class="callout">
        <strong>Recommendation</strong>
        <p class="micro-note">Answer the first question to see suggestions.</p>
      </div>
    </div>

    <!-- Apply buttons -->
    <div class="btn-row" id="rec_applyRow" style="display:none;">
      <button type="button" id="rec_applyPrimary" class="btn-primary"></button>
      <button type="button" id="rec_applyAlt1" class="btn-secondary" style="display:none;"></button>
      <button type="button" id="rec_applyAlt2" class="btn-secondary" style="display:none;"></button>
    </div>

  </div>
</details>
          <!-- Layer 2: symptoms / suspicion -->
          <div class="form-field">
            <label class="field-label" for="persistentSymptoms">
              <span>Persistent / frequent symptoms despite preventive optimization?</span>
            </label>
            <select id="persistentSymptoms" class="field-input">
              <option value="">Select…</option>
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
            <p class="micro-note">
              If “No,” pathway emphasizes preventive optimization and may defer testing (COR 1).
            </p>
          </div>

          <div class="form-field" id="inocaSuspectWrap" style="display:none;">
            <label class="field-label" for="suspectInoca">
              <span>Suspected INOCA?</span>
              <span class="info-chip info-chip--inline" data-modal="modal-inoca" title="When to suspect INOCA">i</span>
            </label>
            <select id="suspectInoca" class="field-input">
              <option value="">Select…</option>
              <option value="no">No / not currently</option>
              <option value="yes">Yes</option>
            </select>
            <p class="micro-note">
              Optional. This does not block results—used to recommend the INOCA pathway link when appropriate.
            </p>
          </div>

          <!-- Layer 2: choose index test strategy if persistent symptoms -->
          <div class="form-field" id="testStrategyWrap" style="display:none;">
            <label class="field-label" for="testStrategy">
              <span>Testing strategy (if symptoms persist)</span>
            </label>
            <select id="testStrategy" class="field-input">
              <option value="">Select…</option>
              <option value="ccta_ffrct">CCTA ± FFR-CT (COR 2a)</option>
              <option value="stress">Stress testing (COR 2a)</option>
            </select>
          </div>

          <!-- Layer 3: feasibility (CCTA) -->
          <div class="form-field" id="cctaFeasWrap" style="display:none;">
            <label class="field-label">
              <span>Layer 3: CCTA feasibility screen</span>
              <span class="info-chip info-chip--inline" data-modal="modal-feas" title="Full feasibility reference (optional)">i</span>
            </label>

            <div class="callout">
              <strong>Abbreviated CCTA limitations (3)</strong>
              <ul>
                <li>Iodinated contrast allergy or significant renal impairment (per local protocol)</li>
                <li>Unable to cooperate with scan/breath-hold</li>
                <li>Arrhythmia/HR variability affecting image quality</li>
              </ul>
            </div>

            <label class="toggle-row" for="cctaAnyLimit">
              <span>Any major limitation applies?</span>
              <select id="cctaAnyLimit" class="field-input field-input--compact">
                <option value="">Select…</option>
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>

            <div class="form-field" style="margin-top:0.35rem;">
              <label class="field-label" for="cctaNotes"><span>Optional note</span></label>
              <input id="cctaNotes" class="field-input" placeholder="e.g., contrast allergy; CKD; irregular AF" />
            </div>
          </div>

          <!-- Layer 2: CCTA pathway data -->
          <div class="form-field" id="stenosisWrap" style="display:none;">
            <label class="field-label" for="stenosis4090"><span>40–90% stenosis present on CCTA?</span></label>
            <select id="stenosis4090" class="field-input">
              <option value="">Select…</option>
              <option value="no">No / not applicable</option>
              <option value="yes">Yes</option>
            </select>
            <p class="micro-note">If “Yes,” FFR-CT is typically used to assess hemodynamic significance.</p>
          </div>

          <div class="form-field" id="ffrctWrap" style="display:none;">
            <label class="field-label" for="ffrctLow"><span>FFR-CT ≤ 0.80?</span></label>
            <select id="ffrctLow" class="field-input">
              <option value="">Select…</option>
              <option value="no">No (&gt;0.80)</option>
              <option value="yes">Yes (≤0.80)</option>
            </select>
          </div>

          <!-- Layer 3: feasibility (Stress) -->
          <div class="form-field" id="stressModalityWrap" style="display:none;">
            <label class="field-label" for="stressModality">
              <span>Layer 3: stress modality</span>
              <span class="info-chip info-chip--inline" data-modal="modal-feas" title="Full feasibility reference (optional)">i</span>
            </label>
            <select id="stressModality" class="field-input">
              <option value="">Select…</option>
              <option value="exercise_ecg">Exercise ECG</option>
              <option value="stress_echo">Stress echocardiography</option>
              <option value="stress_nuclear">Stress nuclear (PET/SPECT)</option>
              <option value="stress_cmr">Stress CMR</option>
            </select>
          </div>

          <div class="form-field" id="stressFeasWrap" style="display:none;">
            <label class="field-label"><span>Layer 3: modality feasibility screen</span></label>

            <div class="callout" id="stressAbbrevList">
              <strong>Select a stress modality to view abbreviated considerations.</strong>
            </div>

            <label class="toggle-row" for="stressAnyLimit">
              <span>Any major limitation applies?</span>
              <select id="stressAnyLimit" class="field-input field-input--compact">
                <option value="">Select…</option>
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>

            <div class="form-field" style="margin-top:0.35rem;">
              <label class="field-label" for="stressNotes"><span>Optional note</span></label>
              <input id="stressNotes" class="field-input" placeholder="e.g., uninterpretable ECG; poor echo windows; MRI device; caffeine" />
            </div>
          </div>

          <!-- Layer 2: stress result -->
          <div class="form-field" id="stressResultWrap" style="display:none;">
            <label class="field-label" for="stressResult"><span>Stress test result</span></label>
            <select id="stressResult" class="field-input">
              <option value="">Select…</option>
              <option value="none_mild">None / mild ischemia</option>
              <option value="modsev">Moderate–severe ischemia</option>
              <option value="inconclusive">Inconclusive</option>
            </select>
          </div>
          <button type="button" id="backBtn" class="btn-secondary btn-secondary--full">Back</button>
          <button type="submit" class="btn-primary btn-primary--full">Run pathway</button>
          <button type="button" id="resetBtn" class="btn-secondary btn-secondary--full">Reset</button>
        </form>
      </section>

      <!-- Results -->
      <section class="card card-results">
        <h2 class="card-title">Results</h2>
        <div id="results-container" class="results-body">
          <p class="results-placeholder">Complete selections and tap “Run pathway.”</p>
        </div>
      </section>

      <!-- Flags -->
      <section class="card card-warnings">
        <h2 class="card-title">Flags &amp; notes</h2>
        <div id="flags-container" class="flags-body">
          <p class="results-placeholder">Non-blocking warnings and alternatives appear here.</p>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <p class="disclaimer">
        This tool is for educational and decision-support purposes only. It does not replace clinical judgment,
        institutional guidelines, or specialist consultation.
      </p>
    </footer>
  </div>

  <!-- Modals (optional info prompts) -->
  <div class="modal-backdrop" id="modal-backdrop" aria-hidden="true"></div>

  <div class="modal" id="modal-scope" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Scope</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Stable chest pain module for patients with known nonobstructive CAD (&lt;50%).</li>
          <li>Use acute pathways for suspected ACS/instability.</li>
          <li>Outputs mirror guideline pathway boxes; local protocols apply.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-redflags" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Red flags / exclusions</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Concern for ACS / unstable features</li>
          <li>Hemodynamic instability or severe arrhythmia</li>
          <li>Severe respiratory distress</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-inoca" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>When to suspect INOCA (optional)</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Persistent or recurrent angina symptoms with nonobstructive CAD findings.</li>
          <li>Symptoms disproportionate to anatomic disease burden (high clinical suspicion).</li>
          <li>Consider when standard testing does not explain symptoms or is non-diagnostic.</li>
        </ul>
        <p class="micro-note">
          Detailed diagnostic criteria (microvascular vs vasospastic angina) will be available as optional info prompts inside the dedicated INOCA modules.
        </p>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-feas" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Feasibility reference (optional)</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <p class="micro-note">
          Optional reference. If you want to display a full feasibility table image here later, add it to:
          <code>stable/modules/known_nonobstructive/assets/</code>
          and update this modal.
        </p>
        <p class="micro-note">For now, this module uses abbreviated 3-bullet screens to reduce cognitive load.</p>
      </div>
    </div>
  </div>

  <script type="module" src="./script.js"></script>
</body>
</html>
