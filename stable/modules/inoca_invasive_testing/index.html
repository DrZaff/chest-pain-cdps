<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>INOCA – Invasive Coronary Function Testing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <div class="app-shell">
    <header class="app-header">
      <div>
        <h1 class="app-title">
          INOCA: Invasive Coronary Function Testing
          <span class="info-chip info-chip--inline" data-modal="modal-scope" title="Scope">i</span>
          <span class="info-chip info-chip--warn" data-modal="modal-redflags" title="Red flags / exclusions">!</span>
        </h1>
        <p class="app-subtitle">
          Decision-support for invasive INOCA phenotyping (CMD vs vasospasm vs mixed). Optional prompts only; does not block.
        </p>
      </div>
      <div class="app-meta">
        <a class="btn-secondary" href="/stable/modules/inoca_invasive/index.html">← INOCA chooser</a>
      </div>
    </header>

    <main class="app-main">
      <section class="card card-inputs">
        <h2 class="card-title">Inputs</h2>

        <form id="tool-form" class="form-grid">
          <!-- Optional suspicion prompt -->
          <div class="callout">
            <strong>Context</strong>
            <p class="micro-note" style="margin-top:0.35rem;">
              Use when symptoms persist and obstructive CAD does not explain symptoms.
              <span class="info-chip info-chip--inline" data-modal="modal-suspicion" title="When to suspect INOCA">i</span>
            </p>
          </div>

          <!-- Layer 3: feasibility (single binary) -->
          <div class="form-field">
            <label class="field-label">
              <span>Layer 3: feasibility screen (abbrev)</span>
              <span class="info-chip info-chip--inline" data-modal="modal-feas" title="Reference (optional)">i</span>
            </label>

            <div class="callout">
              <strong>Abbreviated considerations (3)</strong>
              <ul>
                <li>Requires cath lab workflow + expertise (CFR/IMR and/or vasoreactivity testing)</li>
                <li>Bleeding/vascular access considerations and local contraindications apply</li>
                <li>If not feasible, consider PET/CMR (MBFR) or echo (CFVR)</li>
              </ul>
            </div>

            <label class="toggle-row" for="anyLimit">
              <span>Any major limitation applies?</span>
              <select id="anyLimit" class="field-input field-input--compact">
                <option value="">Select…</option>
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>

            <div class="form-field" style="margin-top:0.35rem;">
              <label class="field-label" for="limitNotes"><span>Optional note</span></label>
              <input id="limitNotes" class="field-input" placeholder="e.g., access risk; lab not available; protocol constraints" />
            </div>
          </div>

          <!-- Layer 2: clinician selects findings bucket -->
          <div class="form-field">
            <label class="field-label" for="phenotype">
              <span>Invasive phenotype / result bucket</span>
              <span class="info-chip info-chip--inline" data-modal="modal-criteria" title="Diagnostic criteria tables (optional)">i</span>
            </label>
            <select id="phenotype" class="field-input">
              <option value="">Select…</option>
              <option value="cmd">Coronary microvascular dysfunction (CMD)</option>
              <option value="vsa">Vasospastic angina (VSA)</option>
              <option value="mixed">Mixed CMD + VSA</option>
              <option value="normal">No CMD/VSA identified (normal/negative testing)</option>
              <option value="inconclusive">Inconclusive / incomplete testing</option>
            </select>
            <p class="micro-note">
              This module summarizes common invasive INOCA phenotypes. It does not compute CFR/IMR thresholds or acetylcholine definitions.
            </p>
          </div>

          <button type="submit" class="btn-primary btn-primary--full">Run pathway</button>
          <button type="button" id="resetBtn" class="btn-secondary btn-secondary--full">Reset</button>
        </form>
      </section>

      <section class="card card-results">
        <h2 class="card-title">Results</h2>
        <div id="results-container" class="results-body">
          <p class="results-placeholder">Select a phenotype/result bucket, then tap “Run pathway.”</p>
        </div>
      </section>

      <section class="card card-warnings">
        <h2 class="card-title">Flags &amp; notes</h2>
        <div id="flags-container" class="flags-body">
          <p class="results-placeholder">Non-blocking notes and alternatives appear here.</p>
        </div>
      </section>
    </main>

    <footer class="app-footer">
      <p class="disclaimer">
        This tool is for educational and decision-support purposes only. It does not replace clinical judgment,
        institutional guidelines, or specialist consultation.
      </p>
    </footer>
  </div>

  <!-- Modals -->
  <div class="modal-backdrop" id="modal-backdrop" aria-hidden="true"></div>

  <div class="modal" id="modal-scope" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Scope</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Stable chest pain + suspected INOCA module.</li>
          <li>Invasive coronary function testing phenotyping (CMD/VSA/mixed).</li>
          <li>Results summarized as buckets; thresholds/protocols are institution-specific.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-redflags" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Red flags / exclusions</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Concern for ACS / unstable features</li>
          <li>Hemodynamic instability or severe arrhythmia</li>
          <li>Severe respiratory distress</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-suspicion" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>When to suspect INOCA (optional)</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Persistent/recurrent angina with nonobstructive findings.</li>
          <li>Symptoms disproportionate to anatomic disease burden.</li>
          <li>Testing does not explain symptoms or is non-diagnostic.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="modal" id="modal-criteria" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Diagnostic criteria (optional)</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
<div class="modal-body">
  <div class="callout">
    <strong>Quick use (optional)</strong>
    <ul>
      <li>Use these criteria to label phenotype after nonobstructive findings.</li>
      <li>Helpful when symptoms persist and standard testing is non-diagnostic.</li>
      <li>These are reference criteria; apply institutional protocols.</li>
    </ul>
  </div>

  <h4 style="margin-top:0.9rem;">Microvascular angina</h4>
  <img
    class="criteria-img"
    src="./assets/microvascular_angina.jpg"
    alt="Clinical criteria for suspecting microvascular angina (table)"
    loading="lazy"
  />

  <h4 style="margin-top:1.0rem;">Vasospastic angina</h4>
  <img
    class="criteria-img"
    src="./assets/vasospastic_angina.jpg"
    alt="Diagnostic criteria for vasospastic angina (table)"
    loading="lazy"
  />
</div>
    </div>
  </div>

  <div class="modal" id="modal-feas" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <h3>Reference (optional)</h3>
        <button class="modal-close" data-close="true">×</button>
      </div>
      <div class="modal-body">
        <p class="micro-note">
          Optional reference placeholder (tables/images). If you later want, store images in:
          <code>stable/modules/inoca_invasive_testing/assets/</code>
        </p>
      </div>
    </div>
  </div>

  <script type="module" src="./script.js"></script>
</body>
</html>
